<div id="level_graph_tool" class="container-fluid w3-theme-l3" >

	<div class="row">

		<div class="col-sm-12 w3-theme-d3 w3-card-4 heading">

			<div class="col-sm-12">
				<button class="btn btn-default  btn-circle w3-green w3-left" type="button" (click)="prevTopology()">
					<i class="fa fa-arrow-left" aria-hidden="true"></i>
				</button>
				<H3 class="col-sm-5 w3-center">Topology Template Name: {{currentTopologyTemplate.name}}</H3>
				<H3 class="col-sm-5 w3-center">Topology Template ID: {{currentTopologyTemplate.id}}</H3>
				<button class="btn btn-default btn-circle w3-green w3-right" type="button" (click)="nextTopology()">
					<i class="fa fa-arrow-right" aria-hidden="true"></i>
				</button>
			</div>

			<div class="col-sm-12 w3-center control-group">
				<label class="col-sm-2 ">Abstract Topology</label>
				<md-slider class="col-sm-8" ng-model="currentTopologyTemplate.abstractionLevel" step="1" min="1" max="maxAbstractionLevel"> </md-slider>
				<label class="col-sm-2">Specific Topology</label>
			</div>

			<div class="col-sm-12 w3-center control-group">
				<button class="btn btn-primary w3-green" type="button" (click)="updateTopologyTemplate()">
					<i class="icon fa fa-floppy-o" aria-hidden="true"></i>Save
				</button>
				<button class="btn btn-primary w3-green" type="button" (click)="startRefinement()">Refinement</button>
				<button class="btn btn-primary w3-green" type="button" (click)="startOneStepRefinement()">One Step Refinement</button>
			</div>

		</div>
	</div>

	<div class="row">

		<div id="toolbox_area" class="w3-card-4 col-sm-2 w3-theme">

			<h5 class="w3-center w3-margin">
				<b>Tool Box</b>
			</h5>

			<div class="toolbox-group">

				<label>Selected Repository:</label>
				<div class="dropdown">
					<button id="selcetRepository" class=" w3-theme-d2 btn btn-primary dropdown-toggle" type="button" data-toggle="dropdown">{{selectedRepository.name}}</button>

					<ul class="dropdown-menu" style="width: 100%;">
						<li class="repositoryListItem" *ngIf="repositories.length < 1" disabled>NO REPOSITORY AVAILABLE</li>
						<li class="repositoryListItem" *ngFor="let repository of repositories" (click)="onSelectRepository(repository)">{{ repository.name }}</li>
					</ul>

				</div>

				<button style="width: 100%" class="w3-theme-d2 w3-border-brown btn btn-primary" type="button" data-toggle="collapse" data-target="#toolbox_nodes" aria-expanded="false" aria-controls="toolbox_nodes">
					NodeTypes<i class="fa fa-caret-down w3-right" aria-hidden="true"></i>
				</button>

				<div class="collapse toolbox" id="toolbox_nodes">
					<ul class="list-group">

						<li *ngIf="selectedRepository.nodeTypeList.length < 1" disabled>NO NODETYPES AVAILABLE</li>
						<li class="nodeTemplate w3-round" draggable="true" *ngFor="let nodeType of selectedRepository.nodeTypeList" (drag)="onDrag($event, nodeType)" (dragover)="onDragOver($event)"><img src="http://lorempixum.com/100/100/nature/1" />
							<h3>{{nodeType.name}}</h3></li>
					</ul>
				</div>

				<button style="width: 100%" class="w3-theme-d2 w3-border-brown btn btn-primary" type="button" data-toggle="collapse" data-target="#toolbox_relationshipTypes" aria-expanded="false" aria-controls="toolbox_nodes">
					RelationshipTypes<i class="fa fa-caret-down w3-right" aria-hidden="true"></i>
				</button>

				<div class="collapse toolbox" id="toolbox_relationshipTypes">
					<ul class="list-group">

						<li *ngIf="selectedRepository.relationshipTypeList.length < 1" disabled>NO NODETYPES AVAILABLE</li>
						<li class="nodeTemplate w3-round" draggable="true" *ngFor="let relationshipType of selectedRepository.relationshipTypeList" (drag)="onDrag($event, nodeType)" (dragover)="onDragOver($event)"><img src="http://lorempixum.com/100/100/nature/1" />
							<h3>{{relationshipType.name}}</h3></li>
					</ul>
				</div>
			</div>

			<div class="toolbox-group">
				<label>Selected Level Graph:</label>
				<div class="dropdown">
					<button id="selcetLevelGraph" class=" w3-theme-d2 btn btn-primary dropdown-toggle" type="button" data-toggle="dropdown">{{selectedLevelGraph.name}}</button>

					<ul class="dropdown-menu" style="width: 100%;">
						<li class="levelGraphListItem" *ngIf="levelGraphList.length < 1" disabled>NO LEVEL GRAPH AVAILABLE</li>
						<li class="levelGraphListItem" *ngFor="let levelGraph of levelGraphList" (click)="onSelectLevelGraph(levelGraph.id)">{{ levelGraph.name }}</li>
					</ul>

				</div>

				<div class="tool-item">
					<label>NodeTypes of Level {{currentTopologyTemplate.abstractionLevel}} of Level Graph:</label>

					<button style="width: 100%" class="w3-theme-d2 w3-border-brown btn btn-primary" type="button" data-toggle="collapse" data-target="#levelGraph_nodeTypes" aria-expanded="false" aria-controls="levelGraph_nodeTypes">
						NodeTypes<i class="fa fa-caret-down w3-right" aria-hidden="true"></i>
					</button>

					<div class="collapse toolbox" id="levelGraph_nodeTypes">
						<ul class="list-group">
							<ng-container *ngFor="let levelGraphNode of selectedLevelGraph.levelGraphNodes">

							<li class="nodeTemplate w3-round" draggable="true" *ngIf="(levelGraphNode.levelGraphNodeType === 'NODETYPE' && isInCurrentLevel(levelGraphNode.levelId))" (drag)="onDragLevelGraphNode($event, levelGraphNode)" (dragover)="onDragOver($event)"><img style="width: 32px; height: 32px" src="/test" />
								<h3>{{levelGraphNode.name}}</h3></li>
							</ng-container>
						</ul>
					</div>
				</div>
			</div>

		</div>

		<div id="draw_area" class="col-sm-10 w3-theme-l5 scroll-panel" (mousemove)="onDrawLevelGraphRelation($event)">


			<svg id="parent" (dragover)="onDragOver($event)" (drop)="onDrop($event)">
				
			
				<defs>
   					<marker id="Triangle" viewBox="0 0 10 10" refX="50" refY="5" markerWidth="4" markerHeight="4" orient="auto">
    				  	<path d="M 0 0 L 10 5 L 0 10 z" />
   					</marker>
 				</defs>
 					 
 				<defs>
   					<marker id="TriangleDraw" viewBox="0 0 10 10" refX="8" refY="5" markerWidth="4" markerHeight="4" orient="auto">
    				  	<path d="M 0 0 L 10 5 L 0 10 z" />
   					</marker>
 				</defs>
 				
 				<defs> 
					<linearGradient id="nodeTemplate" x1="50%" y1="100%" x2="50%" y2="0%"> 
						<stop offset="0%" style="stop-color:rgb(0,51,51);stop-opacity:1" />
						<stop offset="25%" style="stop-color:rgb(4,148,196);stop-opacity:1" />
						<stop offset="50%" style="stop-color:rgb(5,193,255);stop-opacity:1" />
						<stop offset="75%" style="stop-color:rgb(4,148,196);stop-opacity:1" />
						<stop offset="100%" style="stop-color:rgb(0,51,51);stop-opacity:1" />
					</linearGradient> 
				</defs>
				
				
				<polyline *ngIf="drawRelation || drawLevelGraphCompliantRelation || drawCurrentLevelGraphCompliantRelation" [attr.points]="currentDrawRelation.path.pathDataString" style="fill:none;stroke:black;stroke-width:6" marker-end="url(#TriangleDraw)" />
				
				
			 	 <g [contextmenu]="[relationshipTemplateContextMenu, {relationshipTemplate: RelationshipTemplate}]"
						*ngFor="let relationshipTemplate of currentTopologyTemplate.relationshipTemplates">
					    <polyline
						[attr.points]="relationshipTemplate.path.pathDataString" style="fill:none;stroke:black;stroke-width:6" marker-end="url(#Triangle)" />
				</g>
				
				<g [contextmenu]="[nodeTemplateContextMenu, {nodeTemplate: nodeTemplate}]" *ngFor="let nodeTemplate of currentTopologyTemplate.nodeTemplates" (click)="stopDrawLevelGraphRelation(nodeTemplate)" (mousedown)="startMoveNode($event, nodeTemplate); setCurrentLevelGraphCompliantRelationshipTypes($event, nodeTemplate.levelGraphNodeId)" (mousemove)="onMoveNode($event)" (mouseup)="stopMoveNode($event)">
						
					<rect rx="20" ry="20" [attr.id]="nodeTemplate.id" [attr.x]="nodeTemplate.x" [attr.y]="nodeTemplate.y" [attr.width]="nodeTemplate.width" [attr.height]="nodeTemplate.height" fill="url(#nodeTemplate)" style="stroke:black;stroke-width:5;" />
							<text [attr.x]="nodeTemplate.x + nodeTemplate.width/2" [attr.y]="nodeTemplate.y + nodeTemplate.height/2" font-family="Verdana" font-size="35" fill="white" text-anchor="middle">{{nodeTemplate.name}}</text>
						
				</g>
				
           </svg>

		</div>

	</div>
</div>

<contextmenu #nodeTemplateContextMenu>
<div class="dropdown open" style="width: 300px">
	<div class="dropdown-menu">
		<ul>

			<li class="dropdown-submenu"><a class="dropdown-item"><i class="fa fa-arrow-right" aria-hidden="true"></i>Level Graph Compliant</a>
				<ul tabindex="-1" class="dropdown-menu">
					<li *ngIf="currentLevelGraphCompliantRelationshipTypes.length < 1">NO COMPLIANT LEVELGRAPH NODE OF RELATIONSHIPTYPE</li>
					<li *ngFor="let levelGraphNode of currentLevelGraphCompliantRelationshipTypes"><a class="dropdown-item" tabindex="-1" (click)="startDrawCurrentLevelGraphCompliantRelation($event, levelGraphNode, nodeTemplateContextMenu.get('nodeTemplate'))">{{levelGraphNode.name}} (ID: {{levelGraphNode.id}})</a></li>
				</ul></li>
			<li><a class="dropdown-menu" (click)="viewDetails(nodeTemplateContextMenu.get('nodeTemplate').nodeTypeId)"><i class="fa fa-eye" aria-hidden="true"></i>View Details</a></li>

			<li><a class="dropdown-item" (click)="viewDetails(nodeTemplateContextMenu.get('nodeTemplate'))"><i class="fa fa-eye" aria-hidden="true"></i>View Details</a></li>
			<li><a class="dropdown-item" (click)="deleteNodeTemplate(nodeTemplateContextMenu.get('nodeTemplate').id)"><i class="fa fa-trash" aria-hidden="true"></i>Delete</a></li>
		</ul>
	</div>
</div>
</contextmenu>

<contextmenu #relationshipTemplateContextMenu>
<div class="dropdown open">
	<div class="dropdown-menu">

		<a class="dropdown-item" (click)="viewDetails(relationshipTemplateContextMenu.get('relationshipTemplate'))"><i class="fa fa-eye" aria-hidden="true"></i>View Details</a> <a class="dropdown-item" (click)="deleteRelationshipTemplate(relationshipTemplateContextMenu.get('relationshipTemplate'))"><i class="fa fa-trash" aria-hidden="true"></i>Delete</a>
	</div>
</div>
</contextmenu>